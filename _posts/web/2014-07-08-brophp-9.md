---
layout: post
title: Brophp教程笔记9-Ajax下
description: ""
categories: [web]
tags: [php,ajax]
---
#Ajax应用的小例子
##vC
[admin/controls/demo.class.php (index)]
目的：显示视图

	class Demo {
		function index() {
			
			$this->display();
		}
	}	

##V
[admin/views/default/demo/index.tpl]

    <html>
        <head>
            <title>Ajax的应用</title>
            <script src="<{$public}>/js/ajax3.0.js"></script>
        </head>

        <body>
            #########################<br>
            #########################<br>
            #########################<br>
            #########################<br>

            <div id="one"> 数据加载中... </div>

            #########################<br>
            #########################<br>
            #########################<br>

            <script>
                function show() {
                    Ajax().get('<{$url}>/test', function(data){
                        document.getElementById("one").innerHTML=data;
                    });
                }
            </script>

            <input type="button" onclick="show()" value="加载" />
        </body>
    </html>
    
ajax请求控制器：当前模块下的test。（注意不能直接请求后台文件 mvc思想）

##C
[admin/controls/demo.class.php (test)]
目的：响应数据请求，发送视图。

		function test() {
			debug();
			$this->assign("hello", "1111111111111111");
			$this->display();
		}


[admin/views/default/demo/test.tpl]

    <div>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        <{$hello}><br>
        <{$hello}><br>
        <{$hello}><br>
        <{$hello}><br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
        @@@@@@@@@@@@@@@@@@@@@@@@<br>
    </div>

#ajax留言板
##pC
[admin/controls/mess.class.php (index)]
目的：显示视图

	class Mess {
		function index() {
			$this->display();
		}
    }


##V
[admin/views/default/mess/index.tpl]
    
    <html>
        <head>
            <title>Ajax留言本</title>

            <script src="<{$public}>/js/ajax3.0.js"> </script>
        </head>

        <body>

            <div id="mess">
                数据加载中....
            </div>

            <script>
                var messobj = document.getElementById("mess");
                function revice() {
                    Ajax().get('<{$url}>/view/'+Math.random(), function(data) {
                        messobj.innerHTML=unescape(data);
                    });
                }

                //负责将表单数据提交给服务器,使用Ajax提交
                function send() {
                    var username=document.frm.username;
                    var content = document.frm.content;

                    
                    Ajax().post('<{$url}>/save', {username:escape(username.value), content:escape(content.value)});

                    username.value="";
                    content.value="";

                    revice();
                }

            </script>

            <form name="frm">
                username: <input type="text" name="username" /> <br>
                content: <textarea name="content" cols="40" rows="5"> </textarea> <br>
                <input onclick="send()" type="button" value="提交" />
            </form>
        </body>
    </html>

---
功能一：提交留言表单，保存数据。

    <input onclick="send()" type="button" value="提交" />//type不能是submit，否则会提交到服务器。


    Ajax().post('<{$url}>/save', {username:escape(username.value), content:escape(content.value)}); //使用escape对字符进行编码，防止因未编码造成的混乱。使用ajax技术提交到save控制器中。
   
专递的数据：$_POST['username']   $_POST['content']
##C
[admin/controls/mess.class.php (save)]

		function save() {
			$mess = $_POST['username']." : ".date("Y-m-d H:i:s")." : ".$_POST['content']."<br>";

			$file = "./mess.txt";

			$fp=fopen($file, "a");
			
			fwrite($fp, $mess);

			fclose($fp);
		}

目的：保存提交的留言数据。
实现方式：文本保存，而非数据库。

---
功能二:显示所有留言。
[admin/views/default/mess/index.tpl]

        var messobj = document.getElementById("mess");
        function revice() {
            Ajax().get('<{$url}>/view/'+Math.random(), function(data) {
                messobj.innerHTML=unescape(data);
            });
        }
        
目的：请求加载留言，到div中。

[admin/controls/mess.class.php (view)]

	function view() {
        debug();
        echo file_get_contents("./mess.txt");
    }
    
目的：获取留言数据。
Math.random（）//防止缓存。
unescape(data);//将数据中编码的部分解码。

